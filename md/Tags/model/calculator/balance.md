# 잔금계산기 (Balance Calculator)

## 개요

- 분양/매매 계약 시 잔금 납부 시점에 필요한 실제 자금, 대출, 이자, 관리비, 공실 등 다양한 요소를 반영하여 실질적으로 필요한 자금과 손실을 계산하는 도구입니다.
- 실무에서 분양/매매/임대 투자자, 실수요자 모두에게 필수적인 자금 시뮬레이션 기능을 제공합니다.

## 최근 변경/리팩토링 내역

### 1. Input, Button 컴포넌트 개선 및 분리

- **Input**: forwardRef, 타입 안전성, 콤마 처리, 에러 표시 등 유지. type이 number일 때 콤마 처리 제외, UX 개선.
- **Button**: useFormStatus로 로딩/비활성화, props 확장, 한글화.
- **named export**로 변경하여 일관성 및 재사용성 강화.

#### 코드 예시

```tsx
// Input
export function Input({ ... }) { ... }
// Button
export function Button({ ... }) { ... }
```

### 2. balance-page.tsx 구조 개선

- **import** 시 named export 사용: `import { Input } from ...`, `import { Button } from ...`
- **handleValueChange** 등 state 업데이트 시 불변성(immutability) 철저히 준수. setValues 콜백 내에서만 값 변경, 기존 values 직접 수정 금지.
- **UX 개선**: 콤마 처리, 에러 표시, 입력별 의존성 리셋 등 실무적 입력 흐름 최적화.

#### 개선 전 문제점

- setValues 후 values를 직접 수정 → 비동기 업데이트로 인한 버그 가능성
- default export 혼용 → 유지보수성 저하

#### 개선 후 장점

- 상태 일관성 보장, 예측 가능한 동작
- 컴포넌트 재사용성/확장성 향상
- 실무적 입력 UX(숫자/콤마/에러 등) 최적화

### 3. helpers, cost 등 파일 분리

- balance-helpers.ts: 타입, balanceCompute, initialState 등 분리
- cost.tsx: 월별 손실비용 시뮬레이션 컴포넌트 분리
- 각 파일은 interface, 함수형 패턴, 한글 주석 등 일관성 유지

### 4. 마이그레이션/사용 팁

- 기존 default export → named export로 변경 시, import 구문도 반드시 맞춰야 함
- setValues 등 state 업데이트는 항상 콜백 패턴으로 불변성 유지
- Input의 onValueChange value는 string이므로, 상위에서 number 변환 필요시 명확히 처리

### 5. 실무적 장점

- 유지보수성, 확장성, 타입 안정성, UX 모두 강화
- 실무에서 잦은 입력/수정/오류 상황에 강인한 구조
- 컴포넌트 재사용 및 테스트 용이

---

## 입력 필드

| 필드명            | 설명                         | 예시        |
| ----------------- | ---------------------------- | ----------- |
| 분양가(salePrice) | 공급가+부가세 포함 총 분양가 | 350,000,000 |
| 부가세(surtax)    | 분양가 내 부가세 금액        | 35,000,000  |
| 계약금비율        | 분양가 대비 계약금 비율(%)   | 10          |
| 중도금비율        | 분양가 대비 중도금 비율(%)   | 60          |
| 잔금대출비율      | 공급가 대비 잔금대출 비율(%) | 30          |
| 잔금대출액        | 공급가 기준 대출액           | 90,000,000  |
| 중도금이율        | 중도금 대출 연이율(%)        | 5.5         |
| 중도금이자(월)    | 월 납부 이자                 | 250,000     |
| 잔금대출이율      | 잔금대출 연이율(%)           | 4.5         |
| 잔금이자(월)      | 월 납부 이자                 | 180,000     |
| 계약면적(㎡)      | 공급받는 면적(㎡)            | 84          |
| 관리비            | 월 관리비                    | 120,000     |
| 공실개월수        | 예상 공실 기간(개월)         | 4           |

---

## 출력 필드

| 필드명          | 설명                      |
| --------------- | ------------------------- |
| 계약금          | 실제 계약금 금액          |
| 중도금          | 실제 중도금 금액          |
| 잔금대출액      | 실제 잔금대출 금액        |
| 중도금부가세    | 중도금에 포함된 부가세    |
| 취득세          | 등기 시 납부 취득세       |
| 등기시 필요현금 | 등기 시점에 필요한 현금   |
| 환급액          | 잔금 부가세 환급 예상액   |
| 실질자금        | 환급액 제외 실제 투입자금 |
| 소요자금 합계   | 총 필요 자금              |
| 누적손실비용    | 공실기간 동안의 손실비용  |
| 평당가격        | 공급가/평수               |
| 관리비(평당)    | 평당 관리비               |

---

## 주요 계산 수식

- **계약금**: `분양가 × 계약금비율 / 100`
- **중도금**: `분양가 × 중도금비율 / 100`
- **잔금대출액**: `공급가 × 잔금대출비율 / 100`
- **중도금이자(월)**: `중도금 × 중도금이율 / 12 / 100`
- **잔금이자(월)**: `잔금대출액 × 잔금대출이율 / 12 / 100`
- **취득세**: `(공급가) × 취득세율(%) / 100`
- **등기시 필요현금**: `분양가 - 계약금 - 잔금대출 + (부가세 × (100-계약금비율-중도금비율)/100) + 중도금부가세 + 취득세`
- **환급액**: `부가세 × (100-계약금비율-중도금비율)/100`
- **실질자금**: `등기시 필요현금 - 환급액`
- **소요자금 합계**: `계약금 - (부가세 × 계약금비율/100) + 실질자금`
- **누적손실비용**: `2개월(중도금이자) + (공실개월-2) × (잔금이자+관리비)`

---

## 예시 시나리오

```json
{
  "분양가": 350000000,
  "부가세": 35000000,
  "계약금비율": 10,
  "중도금비율": 60,
  "잔금대출비율": 30,
  "중도금이율": 5.5,
  "잔금대출이율": 4.5,
  "계약면적": 84,
  "관리비": 120000,
  "공실개월수": 4
}
```

- 위 입력값 기준, 각 출력 필드가 자동 계산되어 UI에 표시됩니다.
- 입력값을 바꿀 때마다 실시간으로 모든 값이 갱신됩니다.

---

## 실무 활용 팁

- **공실기간**은 최소 2개월 이상, 넉넉하게 입력하는 것이 안전합니다.
- **잔금대출비율**은 공급가 기준으로 계산되므로, 부가세를 제외한 금액을 기준으로 합니다.
- **이자/관리비**는 실제 납부액과 다를 수 있으니, 보수적으로 입력하세요.
- **계약면적**을 입력하면 평수, 평당가격, 평당관리비가 자동 계산됩니다.
- **필드별 오류/유효성**: 분양가/부가세/비율/이자 등은 실무 범위 내에서만 입력 가능하며, 오류시 즉시 안내 메시지 표시됩니다.

---

## UI 흐름

1. 분양가, 부가세 입력 → 계약금/중도금/잔금대출 비율 및 이자 입력 → 계약면적/관리비/공실개월 입력
2. 각 단계별로 실시간 계산 결과 확인
3. 모든 입력 완료 시, 월별 손실비용 시뮬레이션 테이블 제공

---

## 오류/유효성 체크 예시

- 분양가 1억 미만: "1억 이상만 가능합니다"
- 부가세 2~9% 범위 벗어남: "너무 적습니다/너무 많습니다"
- 계약금/중도금/잔금대출 비율 범위 초과: "최소/최대값 안내"
- 이자/관리비 음수 입력: "음수일 수 없습니다"
- 공실개월 2~30개월 범위 초과: "넉넉하게 2개월 이상 입력하시지요/으악~ 30개월 이상 공실이라니..."

---

## 예시 출력 (json)

```json
{
  "계약금": "35,000,000원",
  "중도금": "210,000,000원",
  "잔금대출액": "90,000,000원",
  "중도금부가세": "21,000,000원",
  "취득세": "8,400,000원",
  "등기시 필요현금": "85,400,000원",
  "환급액": "14,000,000원",
  "실질자금": "71,400,000원",
  "소요자금 합계": "106,400,000원",
  "누적손실비용": "1,060,000원",
  "평당가격": "4,000,000원",
  "관리비(평당)": "1,428원"
}
```

---

## 참고

- 모든 계산식, 변수, UI 흐름, 실무 팁 등은 실제 부동산 실무/투자 환경을 반영하여 설계되었습니다.
- 추가 문의/개선 요청은 개발팀에 문의 바랍니다.

---

## 예시 개선 코드

```tsx
// Input 개선
export function Input({ errors = [], onValueChange, type, ...rest }, ref) {
  const handleChange = (e) => {
    let { value } = e.target;
    if (type !== "number") {
      value = value.replace(/,/g, "");
      if (!isNaN(Number(value)) && value !== "") {
        value = Number(value).toLocaleString();
      }
    }
    onValueChange(value);
  };
  // ...
}

// handleValueChange 개선
function handleValueChange(name: string, value: string | number) {
  setValues((prev) => {
    const next = { ...prev, [name]: value };
    // 의존성 리셋 로직
    // ...
    return next;
  });
}
```

---

## 변경 목적 요약

- 코드 일관성, 유지보수성, 실무적 입력 UX, 타입 안정성, 확장성 모두를 고려한 구조로 개선
- 실무에서 발생할 수 있는 입력/수정/오류 상황에 강인한 구조로 리팩토링
- 향후 추가 기능/입력/출력 확장에도 유연하게 대응 가능
